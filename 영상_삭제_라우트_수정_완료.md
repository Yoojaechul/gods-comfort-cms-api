# ì˜ìƒ ì‚­ì œ ë¼ìš°íŠ¸ ìˆ˜ì • ì™„ë£Œ ë³´ê³ ì„œ

## âœ… ìˆ˜ì • ì™„ë£Œëœ ë¼ìš°íŠ¸

### 1. DELETE /admin/videos/:id (1644ì¤„)
- âœ… Admin ì „ìš© ë¼ìš°íŠ¸ ì¡´ì¬ í™•ì¸
- âœ… Adminì€ owner_id/site_idì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥
- âœ… ì˜ìƒ ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œ
- âœ… ë¡œê·¸ ì¶”ê°€: ë¼ìš°íŠ¸ëª…, user id, role, video id, ì²˜ë¦¬ ê²°ê³¼
- âœ… ì‘ë‹µ í˜•ì‹: `{ ok: true, success: true }`

### 2. DELETE /videos/:id (2509ì¤„)
- âœ… Admin/Creator ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
- âœ… Admin: ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥
- âœ… Creator: ë³¸ì¸ ì†Œìœ (owner_id ì¼ì¹˜)ë§Œ ì‚­ì œ ê°€ëŠ¥
- âœ… ì˜ìƒ ì¡´ì¬ í™•ì¸ í›„ ê¶Œí•œ ì²´í¬
- âœ… ë¡œê·¸ ì¶”ê°€: ë¼ìš°íŠ¸ëª…, user id, role, video id, ì²˜ë¦¬ ê²°ê³¼
- âœ… ì‘ë‹µ í˜•ì‹: `{ ok: true, success: true }`
- âœ… ì—ëŸ¬ ì½”ë“œ: 404 (Video not found), 403 (Access denied)

## ğŸ”’ ì ìš©ëœ ë¡œì§

### DELETE /admin/videos/:id

```javascript
const routeName = "DELETE /admin/videos/:id";
const { id } = request.params;
const user = request.user;

console.log(`[${routeName}] ì‚­ì œ ìš”ì²­ - user: ${user.id}, role: ${user.role}, video_id: ${id}`);

// ì˜ìƒ ì¡´ì¬ í™•ì¸
const video = db.prepare("SELECT * FROM videos WHERE id = ?").get(id);
if (!video) {
  console.log(`[${routeName}] ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${id}`);
  return reply.code(404).send({ error: "Video not found" });
}

// Adminì€ owner_id/site_idì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥
const result = db.prepare("DELETE FROM videos WHERE id = ?").run(id);

if (result.changes === 0) {
  console.error(`[${routeName}] ì‚­ì œ ì‹¤íŒ¨ (ë³€ê²½ëœ í–‰ ì—†ìŒ): ${id}`);
  return reply.code(500).send({ error: "Delete operation failed" });
}

console.log(`[${routeName}] Adminì´ ì˜ìƒ ì‚­ì œ ì„±ê³µ: ${id}`);
return { ok: true, success: true };
```

### DELETE /videos/:id

```javascript
const routeName = "DELETE /videos/:id";
const { id } = request.params;
const user = request.user;

console.log(`[${routeName}] ì‚­ì œ ìš”ì²­ - user: ${user.id}, role: ${user.role}, video_id: ${id}`);

// ì˜ìƒ ì¡´ì¬ í™•ì¸
const video = db.prepare("SELECT * FROM videos WHERE id = ?").get(id);
if (!video) {
  console.log(`[${routeName}] ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${id}`);
  return reply.code(404).send({ error: "Video not found" });
}

// ê¶Œí•œ í™•ì¸: adminì€ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥, creatorëŠ” ë³¸ì¸ ì†Œìœ ë§Œ
if (user.role === "admin") {
  // Admin: owner_id/site_idì™€ ë¬´ê´€í•˜ê²Œ ì‚­ì œ í—ˆìš©
  const result = db.prepare("DELETE FROM videos WHERE id = ?").run(id);
  if (result.changes === 0) {
    console.error(`[${routeName}] ì‚­ì œ ì‹¤íŒ¨ (ë³€ê²½ëœ í–‰ ì—†ìŒ): ${id}`);
    return reply.code(500).send({ error: "Delete operation failed" });
  }
  console.log(`[${routeName}] Adminì´ ì˜ìƒ ì‚­ì œ ì„±ê³µ: ${id}`);
  return { ok: true, success: true };
} else {
  // Creator: ë³¸ì¸ ì†Œìœ ë§Œ ì‚­ì œ ê°€ëŠ¥
  if (video.owner_id !== user.id) {
    console.warn(`[${routeName}] Creator(${user.id})ê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì˜ìƒ(${id}, owner: ${video.owner_id}) ì‚­ì œ ì‹œë„ - ê±°ë¶€`);
    return reply.code(403).send({ error: "Access denied: You can only delete your own videos" });
  }
  const result = db.prepare("DELETE FROM videos WHERE id = ? AND owner_id = ?").run(id, user.id);
  if (result.changes === 0) {
    console.error(`[${routeName}] Creator ì‚­ì œ ì‹¤íŒ¨ (ë³€ê²½ëœ í–‰ ì—†ìŒ): ${id}`);
    return reply.code(500).send({ error: "Delete operation failed" });
  }
  console.log(`[${routeName}] Creatorê°€ ë³¸ì¸ ì˜ìƒ ì‚­ì œ ì„±ê³µ: ${id}`);
  return { ok: true, success: true };
}
```

## ğŸ“ ì‚­ì œ ë°©ì‹

- **í•˜ë“œ ì‚­ì œ**: `DELETE FROM videos WHERE id = ?`
- videos í…Œì´ë¸”ì— `deleted` ë˜ëŠ” `is_deleted` ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ í•˜ë“œ ì‚­ì œ ì‚¬ìš©

## âœ… ì™„ë£Œ ê¸°ì¤€ ë‹¬ì„±

- [x] DELETE /admin/videos/:id ë¼ìš°íŠ¸ ì¡´ì¬ ë° ê°œì„  ì™„ë£Œ
- [x] DELETE /videos/:id ë¼ìš°íŠ¸ ê°œì„  ì™„ë£Œ (admin/creator ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥)
- [x] Adminì€ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥ (owner_id/site_id ë¬´ê´€)
- [x] CreatorëŠ” ë³¸ì¸ ì†Œìœ ë§Œ ì‚­ì œ ê°€ëŠ¥
- [x] ì˜ìƒ ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œ
- [x] ë¡œê·¸ ì¶”ê°€ (ë¼ìš°íŠ¸ëª…, user id, role, video id, ì²˜ë¦¬ ê²°ê³¼)
- [x] ëª…í™•í•œ ì—ëŸ¬ ì½”ë“œ (404: Video not found, 403: Access denied)
- [x] ì‘ë‹µ í˜•ì‹: `{ ok: true, success: true }`

## ğŸ“Š ìµœì¢… ìš”ì•½

**ìˆ˜ì •í•œ ë¼ìš°íŠ¸**: 2ê°œ
- DELETE /admin/videos/:id (1644ì¤„) - ê°œì„  ì™„ë£Œ
- DELETE /videos/:id (2509ì¤„) - ê°œì„  ì™„ë£Œ

**ì£¼ìš” ë³€ê²½ ì‚¬í•­**:
1. DELETE /admin/videos/:idì— ë¡œê·¸ ì¶”ê°€ ë° ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
2. DELETE /videos/:idë¥¼ admin/creator ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
3. Adminì€ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥, CreatorëŠ” ë³¸ì¸ ì†Œìœ ë§Œ ì‚­ì œ ê°€ëŠ¥
4. ì˜ìƒ ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œ ì²˜ë¦¬
5. ëª¨ë“  ë¡œê·¸ì— ë¼ìš°íŠ¸ëª… í¬í•¨

**ê²°ê³¼**: CMS Adminì—ì„œ ì˜ìƒ ì‚­ì œê°€ ì •ìƒ ë™ì‘í•˜ë©°, CreatorëŠ” ë³¸ì¸ ì˜ìƒë§Œ ì‚­ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.




























