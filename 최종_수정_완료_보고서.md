# ìµœì¢… ìˆ˜ì • ì™„ë£Œ ë³´ê³ ì„œ

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. site_id="gods" ê°•ì œ ì ìš© í™•ì¸
ëª¨ë“  videos ìƒì„±/ëŒ€ëŸ‰ë“±ë¡/ë°°ì¹˜ë“±ë¡ ë¼ìš°íŠ¸ì—ì„œ ì´ë¯¸ `site_id="gods"`ë¡œ ê°•ì œ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

- âœ… **POST /admin/videos** (1527ì¤„)
  - `const targetSiteId = "gods";`ë¡œ í•˜ë“œì½”ë”©
  - í”„ë¡ íŠ¸ì—”ë“œê°€ ë³´ë‚¸ `site_id` ë¬´ì‹œ
  - ì €ì¥ ì§ì „ sites í…Œì´ë¸”ì— id="gods" ì¡´ì¬ í™•ì¸

- âœ… **POST /videos/bulk** (1906ì¤„)
  - `const siteId = "gods";`ë¡œ í•˜ë“œì½”ë”©
  - í”„ë¡ íŠ¸ì—”ë“œê°€ ë³´ë‚¸ `site_id` ë¬´ì‹œ
  - ì €ì¥ ì§ì „ sites í…Œì´ë¸”ì— id="gods" ì¡´ì¬ í™•ì¸

- âœ… **POST /videos/batch** (2054ì¤„)
  - `const siteId = "gods";`ë¡œ í•˜ë“œì½”ë”©
  - í”„ë¡ íŠ¸ì—”ë“œê°€ ë³´ë‚¸ `site_id` ë¬´ì‹œ
  - ì €ì¥ ì§ì „ sites í…Œì´ë¸”ì— id="gods" ì¡´ì¬ í™•ì¸

- âœ… **POST /videos** (2189ì¤„)
  - `const siteId = "gods";`ë¡œ í•˜ë“œì½”ë”©
  - í”„ë¡ íŠ¸ì—”ë“œê°€ ë³´ë‚¸ `site_id` ë¬´ì‹œ
  - ì €ì¥ ì§ì „ sites í…Œì´ë¸”ì— id="gods" ì¡´ì¬ í™•ì¸

### 2. ì˜ìƒ ì‚­ì œ ë¼ìš°íŠ¸ í™•ì¸ ë° ê°œì„ 
- âœ… **DELETE /admin/videos/:id** (1644ì¤„)
  - Admin ì „ìš© ë¼ìš°íŠ¸ ì¡´ì¬ í™•ì¸
  - Adminì€ owner_id/site_idì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥
  - ì˜ìƒ ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œ
  - ë¡œê·¸ ì¶”ê°€ ì™„ë£Œ

- âœ… **DELETE /videos/:id** (2527ì¤„)
  - Admin/Creator ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥
  - Admin: ëª¨ë“  ì˜ìƒ ì‚­ì œ ê°€ëŠ¥
  - Creator: ë³¸ì¸ ì†Œìœ ë§Œ ì‚­ì œ ê°€ëŠ¥
  - ë¡œê·¸ ì¶”ê°€ ì™„ë£Œ

### 3. ì¸ë„¤ì¼ ì—…ë¡œë“œ ë¼ìš°íŠ¸ êµ¬í˜„
- âœ… **POST /admin/uploads/thumbnail** (2687ì¤„)
  - ë©€í‹°íŒŒíŠ¸ íŒŒì¼ ì—…ë¡œë“œ ì§€ì› êµ¬í˜„ ì™„ë£Œ
  - `@fastify/multipart` í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ ì™„ë£Œ
  - íŒŒì¼ ì €ì¥ ê²½ë¡œ: `uploads/thumbnails/`
  - íŒŒì¼ëª… í˜•ì‹: `{timestamp}_{randomId}.{ext}`
  - í—ˆìš© í™•ì¥ì: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`
  - íŒŒì¼ í¬ê¸° ì œí•œ: 10MB
  - ì‘ë‹µ í˜•ì‹: `{ url: "/uploads/thumbnails/{filename}", filename: "...", video_id: "..." }`
  - ì •ì  íŒŒì¼ ì„œë¹™ ì„¤ì • ì™„ë£Œ (`/uploads` ê²½ë¡œ)

### 4. ë¼ìš°íŒ… êµ¬ì¡° í™•ì¸
- âœ… Fastify ì•±ì€ ëª¨ë“  ë¼ìš°íŠ¸ë¥¼ ì§ì ‘ ë“±ë¡ (`app.get/post/put/delete/patch`)
- âœ… ë¼ìš°íŠ¸ëŠ” ë“±ë¡ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ë¨
- âœ… CORS, JWT, Multipart, Static Files í”ŒëŸ¬ê·¸ì¸ì´ ëª¨ë‘ ì •ìƒ ë“±ë¡ë¨
- âœ… ëª¨ë“  ë¼ìš°íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë¨

## ğŸ“ ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. ë©€í‹°íŒŒíŠ¸ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
```javascript
import multipart from "@fastify/multipart";
import fs from "fs";

// ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ ì§€ì›
await app.register(multipart, {
  limits: {
    fileSize: 10 * 1024 * 1024, // 10MB ì œí•œ
  },
});
```

### 2. ì¸ë„¤ì¼ ì—…ë¡œë“œ ë¼ìš°íŠ¸ êµ¬í˜„
```javascript
app.post(
  "/admin/uploads/thumbnail",
  { preHandler: [authenticate, requireAdmin] },
  async (request, reply) => {
    const routeName = "POST /admin/uploads/thumbnail";
    const user = request.user;

    // ë©€í‹°íŒŒíŠ¸ ë°ì´í„° íŒŒì‹±
    const data = await request.file();
    
    // íŒŒì¼ ê²€ì¦ ë° ì €ì¥
    // ...
    
    // URL ìƒì„± ë° ë°˜í™˜
    return {
      url: thumbnailUrl,
      filename: filename,
      video_id: videoId || null,
    };
  }
);
```

### 3. ì •ì  íŒŒì¼ ì„œë¹™ ì¶”ê°€
```javascript
// ì—…ë¡œë“œëœ ì¸ë„¤ì¼ íŒŒì¼ ì„œë¹™
await app.register(staticFiles, {
  root: path.join(__dirname, "uploads"),
  prefix: "/uploads",
  decorateReply: false
});
```

## âœ… ì™„ë£Œ ê¸°ì¤€ ë‹¬ì„±

- [x] ëª¨ë“  videos ìƒì„± ë¼ìš°íŠ¸ì—ì„œ site_id="gods" ê°•ì œ ì ìš© í™•ì¸
- [x] DELETE /admin/videos/:id ë¼ìš°íŠ¸ ì •ìƒ ë™ì‘ í™•ì¸
- [x] POST /admin/uploads/thumbnail ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ êµ¬í˜„ ì™„ë£Œ
- [x] ë¼ìš°íŒ… êµ¬ì¡° í™•ì¸ ë° ì •ì  íŒŒì¼ ì„œë¹™ ì„¤ì • ì™„ë£Œ
- [x] FOREIGN KEY ì˜¤ë¥˜ ë°©ì§€ ë¡œì§ ìœ ì§€

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. site_id ê°•ì œ ì ìš© í…ŒìŠ¤íŠ¸
```bash
# POST /admin/videosì— ìˆ«ì site_id ì „ì†¡
curl -X POST http://localhost:8787/admin/videos \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"platform": "youtube", "source_url": "https://youtube.com/watch?v=test", "site_id": 1765684445}'

# ì„œë²„ ë¡œê·¸ì—ì„œ "site_id(1765684445) -> 'gods' ê°•ì œ" ë©”ì‹œì§€ í™•ì¸
# DBì—ì„œ ì‹¤ì œ ì €ì¥ëœ site_idê°€ "gods"ì¸ì§€ í™•ì¸
```

### 2. ì˜ìƒ ì‚­ì œ í…ŒìŠ¤íŠ¸
```bash
# Adminìœ¼ë¡œ ì˜ìƒ ì‚­ì œ
curl -X DELETE http://localhost:8787/admin/videos/{video_id} \
  -H "Authorization: Bearer {admin_token}"

# ì‘ë‹µ: {"ok": true, "success": true}
# ì„œë²„ ë¡œê·¸ì—ì„œ "[DELETE /admin/videos/:id] Adminì´ ì˜ìƒ ì‚­ì œ ì„±ê³µ" í™•ì¸
```

### 3. ì¸ë„¤ì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
```bash
# ë©€í‹°íŒŒíŠ¸ íŒŒì¼ ì—…ë¡œë“œ
curl -X POST http://localhost:8787/admin/uploads/thumbnail \
  -H "Authorization: Bearer {admin_token}" \
  -F "file=@/path/to/thumbnail.jpg" \
  -F "video_id=optional_video_id"

# ì‘ë‹µ: {"url": "/uploads/thumbnails/1234567890_abc123.jpg", "filename": "...", "video_id": "..."}
# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8787/uploads/thumbnails/{filename} ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸
```

## ğŸ“Š ê´€ë ¨ ë¼ìš°íŠ¸ ëª©ë¡

### Videos ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- `POST /admin/videos` - Admin ì˜ìƒ ìƒì„± (site_id="gods" ê°•ì œ)
- `POST /videos/bulk` - ì¼ê´„ ì˜ìƒ ìƒì„± (site_id="gods" ê°•ì œ)
- `POST /videos/batch` - ë°°ì¹˜ ì˜ìƒ ìƒì„± (site_id="gods" ê°•ì œ)
- `POST /videos` - Creator ì˜ìƒ ìƒì„± (site_id="gods" ê°•ì œ)
- `DELETE /admin/videos/:id` - Admin ì˜ìƒ ì‚­ì œ
- `DELETE /videos/:id` - Admin/Creator ì˜ìƒ ì‚­ì œ

### íŒŒì¼ ì—…ë¡œë“œ
- `POST /admin/uploads/thumbnail` - ì¸ë„¤ì¼ íŒŒì¼ ì—…ë¡œë“œ (ë©€í‹°íŒŒíŠ¸)

### ì •ì  íŒŒì¼ ì„œë¹™
- `GET /uploads/thumbnails/{filename}` - ì—…ë¡œë“œëœ ì¸ë„¤ì¼ íŒŒì¼ ì ‘ê·¼

## ğŸ”’ FOREIGN KEY ì˜¤ë¥˜ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜

1. **site_id ê°•ì œ ì ìš©**: ëª¨ë“  videos ìƒì„± ì‹œ `site_id="gods"`ë¡œ í•˜ë“œì½”ë”©
2. **sites í…Œì´ë¸” ì‚¬ì „ í™•ì¸**: ì €ì¥ ì§ì „ sites í…Œì´ë¸”ì— id="gods" ì¡´ì¬ í™•ì¸
3. **owner_id ê²€ì¦ ë° ìë™ ë³µêµ¬**: users í…Œì´ë¸”ì— ì—†ìœ¼ë©´ ê°€ì¥ ì˜¤ë˜ëœ admin/creator ì‚¬ìš©
4. **ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€**: FK ì˜¤ë¥˜ ë°œìƒ ì‹œ êµ¬ì²´ì ì¸ ì›ì¸ í‘œì‹œ

## ğŸ“Œ ì£¼ì˜ì‚¬í•­

1. **ì—…ë¡œë“œ ë””ë ‰í† ë¦¬**: `uploads/thumbnails/` ë””ë ‰í† ë¦¬ê°€ ìë™ ìƒì„±ë˜ì§€ë§Œ, ì„œë²„ ì¬ì‹œì‘ ì‹œ ê¸°ì¡´ íŒŒì¼ì€ ìœ ì§€ë©ë‹ˆë‹¤.
2. **íŒŒì¼ í¬ê¸° ì œí•œ**: ì¸ë„¤ì¼ ì—…ë¡œë“œëŠ” 10MBë¡œ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.
3. **íŒŒì¼ í™•ì¥ì**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.
4. **ì •ì  íŒŒì¼ ì„œë¹™**: `/uploads` ê²½ë¡œë¡œ ì—…ë¡œë“œëœ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âœ… ìµœì¢… í™•ì¸

ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©°, CMS Adminì—ì„œ ë‹¤ìŒ ê¸°ëŠ¥ì´ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤:
- ì˜ìƒ ìƒì„±/ëŒ€ëŸ‰ë“±ë¡/ë°°ì¹˜ë“±ë¡ (site_id="gods" ìë™ ì ìš©)
- ì˜ìƒ ì‚­ì œ (Admin/Creator ê¶Œí•œë³„ ì²˜ë¦¬)
- ì¸ë„¤ì¼ íŒŒì¼ ì—…ë¡œë“œ (ë©€í‹°íŒŒíŠ¸ ì§€ì›)




























